<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="/userCheck.css">
    <title>

        <%= newUser %>

    </title>
</head>

<body>

    <nav id="navbar" class="navbar navbar-dark navbar-expand-md bg-dark text-light mb-2">
        <div class="container-fluid">
            <a class="navbar-brand border-bottom border-3 rounded-bottom border-light" href="#">
                <%= newUser %>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse justify-content-evenly" id="navbarNav">
                <ul class="navbar-nav d-flex w-100">
                    <li class="nav-item ms-2 mt-2"> <a href="/employee/myData"><button
                                class="btn btn-info">Home</button></a>
                    </li>
                    <li class="nav-item ms-2 mt-2"> <a href="/employee/askForHolidays"><button
                                class="btn btn-info">Dopust</button></a></li>
                    <li class="nav-item ms-auto me-right mt-2">
                        <a href="/logMeOut"><button class="btn btn-outline-info">Logout</button></a>
                    </li>
                </ul>
            </div>
    </nav>

    <div class="container text-center mt-3">
        <%# include('../../flashError') %>
        <div class="row">
            <% if(!findedEmployee.length) {%>
            <div class="col ms-auto me-auto">
                    <div class="info text-center bg-success mt-1 mb-3 p-3">
                        <h1 class="text-center text-light">
                            <%= newUser %>
                        </h1>
                        <h3 class="text-center bg-success text-light">Vsi računi so plačani!</h3>
                    </div>
                    </div>
                    <% }else { %>
                        <div class="col ms-auto me-auto">
                            <div class="info text-center text-light bg-danger mb-3 mt-1 ms-auto me-auto">
                                <h1 id="forPay" class="text-center">
                                    <%= newUser %>
                                </h1>
                                <h3 class="text-center">Računi za plačilo</h3>
                            </div>
                        </div>

                        <div class="row">
                            <div id="table">
                            <div class="table-info">
                                <table id="table-data" class="table table-dark table-hover mt-3 text-center">
                                    <thead id="thead-data">
                                        <th class="col">Izdelek</th>
                                        <th class="col">Količina</th>
                                        <th class="col">Cena</th>
                                        <th class="col">Mesec</th>
                                        <th class="col">Teden</th>
                                        <th class="col">Plačano</th>
                                        <th class="col">Datum izdaje</th>
                                        <th class="col">Izdal</th>

                                    </thead>
                                    <tbody>
                                        <% for(let user of findedEmployee) {%>
                                            <% for(let product of user.products) {%>
                                                <tr>
                                                    <td>
                                                        <%= product.name %>
                                                    </td>
                                                    <td>
                                                        <%= product.qty %>
                                                    </td>
                                                    <td>
                                                        <%= product.total %>
                                                    </td>

                                                    <td>
                                                        <%= user.month %>
                                                    </td>
                                                    <td>
                                                        <%= user.kt %>
                                                    </td>
                                                    <td>
                                                        <img src="../notPay.jpg" alt="Not Payed">
                                                    </td>
                                                    <td>
                                                        <%= user.soldDate %>
                                                    </td>
                                                    <td>
                                                        <%= user.izdal %>
                                                    </td>
                                                </tr>
                                                <% } %>
                                                    <% } %>
                                                        <tr class="bg-danger">
                                                            <td>Za Plačat</td>
                                                            <td></td>
                                                            <td id="total"></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            </div>
                        </div>
                        <% } %>
        </div>

            <div class="row">
            <div class="col bg-danger ms-auto me-auto mt-5 mb-5">
                <caption class="mb-2">
                    <h2 class="mb-3 p-2">
                        Stanje letnega dopusta in ur za leto <%= year %>
                    </h2>
                </caption>
            </div>
            <div id="stanje" class="row">
                <table id="stanjeLetnegaDopusta" class="table table-info mt-2 mb-5">
                    <thead id="stanjeHead">
                        <th>Lanski dopust</th>
                        <th>Letni dopust</th>
                        <th>Skupaj za tekoče leto</th>
                        <th>Koriščeno</th>
                        <th>Preostalo</th>
                        <th>Ure</th>
                        <th>Koriščeno</th>
                        <th>Preostale ure</th>
                    </thead>
                    <tbody>
                        <% for(user of holidayInfo) {%>
                            <tr>
                                <td id="lanskiDopust">
                                    <%= user.lastYearHolidays %>
                                </td>
                                <td id="letniDopust">
                                    <%= user.holidays %>
                                </td>
                                <td id="skupaj"></td>
                                <td id="korisceno">
                                    <%= user.usedHolidays %>
                                </td>
                                <td id="preostalo"></td>
                                <td id="ure">
                                    <%= user.overtime %>
                                </td>
                                <td id="korisceneUre">0</td>
                                <td id="preostaleUre"></td>
                                <% } %>
                            </tr>
                    </tbody>
                </table>
            </div>

            <div class="row">
                <caption class="mb-2 mt-2">
                    <h2 class="mb-3">
                        Planiran dopust za leto <%= year %>
                    </h2>
                </caption>
            </div>
            <div id="planiran" class="row">
                <table id="planiranDopust" class="table ms-auto me-auto mt-4 align-items-center">
                    <thead id="planiranHead">
                        <th>Prvi dan dopusta</th>
                        <th>Zadnji dan dopusta</th>
                        <th>Dni</th>
                        <th>Status</th>
                        <th>Datum</th>
                        <th>Uredi</th>
                        <th>Izbriši</th>
                    </thead>
                    <% for(info of holidayInfo) {%>
                        <% for(userInfo of info.pendingHolidays) {%>
                            <tr id="myRow" class="">
                                <td>
                                    <%= userInfo.startDate%>
                                </td>
                                <td>
                                    <%= userInfo.endDate%>
                                </td>
                                <td>
                                    <%= userInfo.days%>
                                </td>
                                <td id="status" class="">
                                    <%= userInfo.status%>
                                </td>
                                <td>
                                    <%= userInfo.applyDate%>
                                </td>
                                <% if(userInfo.status=='Pending' ) {%>
                                    <td>
                                        <a href="/employee/myData/<%= userInfo.id%> "><button
                                                class="btn btn-warning btn-sm">Uredi</button></a>

                                    </td>
                                    <td>
                                        <form class="d-inline ms-auto me-auto"
                                            action="/employee/myData/delete/<%= user.id%>" method="post">
                                            <input type="text" name="deleteVacId" id="deleteVacId" hidden
                                                value="<%= userInfo.id%>">
                                            <button class="btn btn-danger btn-sm">Izbriši</button>
                                        </form>
                                    </td>

                                    <% }else{ %>
                                        <td>
                                            <a href="#"><button class="btn btn-secondary btn-sm">Neaktivno</button></a>

                                        </td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm">Neaktivno</button>

                                        </td>
                                        <% } %>
                            </tr>
                            <% } %>
                                <% } %>
                </table>
            </div>
            </div>
    </div>


    <script>

        let user = document.getElementById('forPay')
        if (user) {
            const my_Table = document.getElementById('table-data');
            const row = my_Table.rows.length - 2;
            let pay = 0;
            let qty = 0;
            for (let i = 1; i <= row; i++) {
                var x = document.getElementById('table-data').rows[i].cells[2].innerHTML;
                pay += parseFloat(x, 10)
            }
            document.getElementById('total').innerHTML = pay.toFixed(2) + '' + '€'
            document.getElementById('total').style.backgroundColor = "red"
        }

        const letniDopust = document.getElementById('stanjeLetnegaDopusta');
        const dopustRow = letniDopust.rows.length - 1;
        if (dopustRow > 0) {
            let lanskiDopust = document.getElementById('lanskiDopust').innerText;
            let dopust = document.getElementById('letniDopust').innerText;
            let skupaj = parseInt(lanskiDopust) + parseInt(dopust);
            document.getElementById('skupaj').innerText = skupaj;
            let korisceno = document.getElementById('korisceno').innerText;
            let preostalo = parseInt(skupaj) - parseInt(korisceno);
            document.getElementById('preostalo').innerText = preostalo;
            let ure = document.getElementById('ure').innerText;
            let korisceneUre = document.getElementById('korisceneUre').innerText;
            let preostaleUre = parseFloat(ure) - parseFloat(korisceneUre);
            document.getElementById('preostaleUre').innerText = preostaleUre.toFixed(2);
        }
        const vlogaDopust = document.getElementById('planiranDopust');
        const planiranRows = vlogaDopust.rows.length - 1;
        if (planiranRows > 0) {
            let approved = 'Approved';
            let rejected = 'Rejected';
            for (let i = 1; i <= planiranRows; i++) {
                var status = document.getElementById('planiranDopust').rows[i].cells[3].innerText;
                if (status == 'Approved') {
                    document.getElementById('planiranDopust').rows[i].setAttribute('class', 'bg-success')
                }
                if (status == 'Rejected') {
                    document.getElementById('planiranDopust').rows[i].setAttribute('class', 'bg-danger')
                    //console.log(status)

                }
            }

        }


    </script>


    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
        integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
        integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
        crossorigin="anonymous"></script>
</body>

</html>